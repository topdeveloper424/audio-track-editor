{% extends 'layouts/main.html' %} {% load static %} {% block title %} audio tool {% endblock %} {% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'vendors/css/dropzone.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'vendors/css/toastr.css' %}">
<style>
    .dropzone .dz-message {
        margin: 0 0!important;
        font-size: 1rem!important;
        top: 35%!important;
    }
    
    .dropzone {
        min-height: 150px!important;
    }
</style>
{% endblock %} {% load string_filters %} {% block content %}
<div class="card">
    <div class="card-header">
        <h4 class="card-title" id="basic-layout-round-controls"><img class="mr-3" src="{% static 'img/voice.png' %}" width="50px" />Track Combination </h4>
    </div>
    <div class="card-content ">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="px-3" id="voiceSelectContainer">
                        <p>Select Voice Track</p>
                        <select class="form-control" id="voiceSelect">
                            {% for voice in voices %}
                            <option value="{{voice.id}}">{{voice.name}}</option>
                            {% endfor %}
                        </select>
                    </div>

                </div>
                <div class="col-md-6">
                    <div class="px-3" id="backgroundSelectContainer">
                        <p>Select Background Tracks</p>
                        <select class="form-control" id="backgroundSelect" multiple="multiple">
                            {% for background in backgrounds %}
                            <option value="{{background.id}}">{{background.name}}</option>
                            {% endfor %}
                        </select>
                    </div>

                </div>

            </div>
            <div class="row mb-2 mt-4">
                <div class="col-md-3 text-center">
                    <div class="px-3">
                        <input type="number" class="form-control" step="0.1" id="volumeLevel" placeholder="Enter Db value">
                    </div>
                </div>
                <div class="col-md-6 text-left">
                    <div class="px-3">
                        <button type="button" class="btn btn-raised btn-primary" id="start_btn">
                        <i class="fa fa-check-square-o"></i> Start
                      </button> &nbsp;&nbsp;
                        <div class="spinner-border" role="status" style="display: none;">
                            <span class="sr-only">Please wait for while audio files are being generated...</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-6 col-lg-4">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Results</h4>
            </div>
            <div class="card-content">
                <div class="card-body">
                    <ul class="list-group">
                        {% for track in results %}
                        <a href="{{track.track_file.url}}" class="list-group-item" download>{{track.name}} <i class="ft-download-cloud ml-3"></i></a> {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>



{% endblock %} {% block script%}
<script src="{% static 'vendors/js/dropzone.min.js' %}" type="text/javascript"></script>
<script src="{% static 'vendors/js/toastr.min.js' %}" type="text/javascript"></script>
<script>
    Dropzone.autoDiscover = false;

    $(document).ready(function() {
        $('#backgroundSelect').select2({
            dropdownParent: $('#backgroundSelectContainer'),
        });
        $('#voiceSelect').select2({
            dropdownParent: $('#backgroundSelectContainer'),
        });

        $("#start_btn").click(function() {
            let level = $("#volumeLevel").val();
            if (level == null || level == "") {
                toastr.error("Error Happened!", "Enter correct volume level!")
                return false;
            }

            let voiceTrack = $("#voiceSelect").val();
            if (voiceTrack == "") {
                toastr.error("Error Happened!", "Choose voice track!")
                return false;
            }
            let backgroundTracks = $("#backgroundSelect").val();
            if (backgroundTracks == "" || backgroundTracks.length == 0) {
                toastr.error("Error Happened!", "Choose background tracks!")
                return false;
            }

            $(".spinner-border").show();
            $.ajax({
                _token: '{% csrf_token %}',
                type: "POST",
                url: "{% url 'workspace:proceed' %}",
                data: {
                    level: level,
                    voice_track_id: voiceTrack,
                    background_track_ids: backgroundTracks.toString()
                },
                dataType: 'json',
                success: function(response) {
                    location.reload(true);
                }
            });



        });

    });
</script>
{% endblock %}